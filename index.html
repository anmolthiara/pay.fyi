<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compensation Calculator</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <!-- Select2 for searchable dropdowns -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "IBM Plex Mono", monospace;
            background: rgb(255, 255, 255);
            padding: 20px;
            min-height: 100vh;

            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }


        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            color: #1f2937;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        h2 {
            color: #0c0a09;
            margin-bottom: 20px;
            font-size: 1.25rem;
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .inputs-grid-three {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .inputs-grid-four {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-section {
            background: #e5fbf8;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-weight: 500;
            color: #080807;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #3b82f6;
        }

        select {
            transition: border-color 0.2s;
        }

        select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        /* Select2 custom styling */
        .select2-container--default .select2-selection--single {
            height: 44px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 40px;
            padding-left: 10px;
            font-size: 0.95rem;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 42px;
        }

        .select2-container--default.select2-container--focus .select2-selection--single {
            border-color: #3b82f6;
        }

        .select2-dropdown {
            border: 2px solid #d1d5db;
            border-radius: 6px;
        }

        .select2-search--dropdown .select2-search__field {
            border: 2px solid #d1d5db;
            border-radius: 6px;
            padding: 8px;
        }

        .select2-container {
            width: 100% !important;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e5e7eb;
        }

        .summary-label {
            font-size: 0.85rem;
            color: #57534e;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 1.75rem;
            font-weight: bold;
        }

        .summary-card:nth-child(1) .summary-value {
            color: #3b82f6;
        }

        .summary-card:nth-child(2) .summary-value {
            color: #10b981;
        }

        .summary-card:nth-child(3) .summary-value {
            color: #8b5cf6;
        }

        .summary-card:nth-child(4) .summary-value {
            color: #f59e0b;
        }

        .chart-container {
            background: #e5fbf8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
        }

        canvas {
            max-height: 400px;
        }

        table {
            width: 100%;
            min-width: 700px;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        th {
            background: #f3f4f6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #080807;
            border-bottom: 2px solid #d1d5db;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        tr:hover {
            background: #e5fbf8;
        }

        .text-right {
            text-align: right;
        }

        .note {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #1e40af;
            font-size: 0.9rem;
        }

        .note strong {
            color: #1e3a8a;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            padding: 5px 0;
        }

        .section-header:hover h2 {
            color: #3b82f6;
        }

        .collapse-icon {
            font-size: 1.5rem;
            color: #57534e;
            transition: transform 0.3s ease;
        }

        .collapse-icon.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5rem;
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ðŸ’¼ Compensation Calculator</h1>

        <div class="inputs-grid-four">
            <!-- Cash Compensation -->
            <div class="input-section">
                <div class="section-header" onclick="toggleSection('cashCompSection')">
                    <h2>Cash Compensation</h2>
                    <span class="collapse-icon" id="cashCompIcon">â–¼</span>
                </div>
                <div class="collapsible-content" id="cashCompSection">
                    <p style="font-size: 0.85rem; color: #57534e; margin-bottom: 15px;">Auto-applies 3% annual raise
                        each year</p>

                    <div class="input-group">
                        <label for="baseSalary">Starting Base Salary ($)</label>
                        <input type="number" id="baseSalary" min="0" step="1000" value="0">
                    </div>

                    <div class="input-group">
                        <label for="bonusPercent">Annual Bonus (%)</label>
                        <input type="number" id="bonusPercent" min="0" max="100" step="0.5" value="0">
                        <p style="font-size: 0.75rem; color: #57534e; margin-top: 5px;">Applied to base salary each year
                        </p>
                    </div>

                    <div class="input-group">
                        <label for="signOnBonus">Sign-On Bonus ($)</label>
                        <input type="number" id="signOnBonus" min="0" step="1000" value="0">
                        <p style="font-size: 0.75rem; color: #57534e; margin-top: 5px;">One-time payment in Year 1</p>
                    </div>
                </div>
            </div>

            <!-- Stock Prices -->
            <div class="input-section">
                <div class="section-header" onclick="toggleSection('stockPriceSection')">
                    <h2>Stock Price per Year</h2>
                    <span class="collapse-icon" id="stockPriceIcon">â–¼</span>
                </div>
                <div class="collapsible-content" id="stockPriceSection">
                    <div class="input-group">
                        <label for="stockYear1">Year 1 Stock Price ($)</label>
                        <input type="number" id="stockYear1" min="0" step="1" value="0">
                    </div>

                    <div class="input-group">
                        <label for="stockGrowth">Annual Stock Growth (%)</label>
                        <input type="number" id="stockGrowth" min="-100" max="500" step="1" value="0">
                        <p style="font-size: 0.75rem; color: #57534e; margin-top: 5px;">Auto-calculates Years 2-4 prices
                            (0 = no growth)</p>
                    </div>

                    <div style="border-top: 1px solid #d1d5db; margin: 15px 0; padding-top: 15px;">
                        <p style="font-size: 0.85rem; color: #57534e; margin-bottom: 10px; font-weight: 500;">Or
                            manually set each year:</p>
                    </div>

                    <div class="input-group">
                        <label for="stockYear2">Year 2 Stock Price ($)</label>
                        <input type="number" id="stockYear2" min="0" step="1" value="0">
                    </div>

                    <div class="input-group">
                        <label for="stockYear3">Year 3 Stock Price ($)</label>
                        <input type="number" id="stockYear3" min="0" step="1" value="0">
                    </div>

                    <div class="input-group">
                        <label for="stockYear4">Year 4 Stock Price ($)</label>
                        <input type="number" id="stockYear4" min="0" step="1" value="0">
                    </div>
                </div>
            </div>

            <!-- RSU Refreshers -->
            <div class="input-section">
                <div class="section-header" onclick="toggleSection('rsuGrantsSection')">
                    <h2>RSU Grants</h2>
                    <span class="collapse-icon" id="rsuGrantsIcon">â–¼</span>
                </div>
                <div class="collapsible-content" id="rsuGrantsSection">
                    <div class="input-group">
                        <label for="initialGrant">Initial Grant (RSUs)</label>
                        <input type="number" id="initialGrant" min="0" step="10" value="0">
                    </div>

                    <div class="input-group">
                        <label for="vestingSchedule">Vesting Schedule</label>
                        <select id="vestingSchedule"
                            style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 0.95rem;">
                            <option value="front">Front-loaded (40/30/20/10)</option>
                            <option value="even">Even (25/25/25/25)</option>
                        </select>
                    </div>

                    <div style="border-top: 1px solid #d1d5db; margin: 15px 0; padding-top: 15px;">
                        <p style="font-size: 0.85rem; color: #57534e; margin-bottom: 10px; font-weight: 500;">Annual
                            Refreshers:</p>
                    </div>

                    <div class="input-group">
                        <label for="refresherYear2">Year 2 Grant (RSUs)</label>
                        <input type="number" id="refresherYear2" min="0" step="10" value="0">
                    </div>

                    <div class="input-group">
                        <label for="refresherYear3">Year 3 Grant (RSUs)</label>
                        <input type="number" id="refresherYear3" min="0" step="10" value="0">
                    </div>

                    <div class="input-group">
                        <label for="refresherYear4">Year 4 Grant (RSUs)</label>
                        <input type="number" id="refresherYear4" min="0" step="10" value="0">
                    </div>

                    <div class="input-group">
                        <label for="refresherVesting">Refresher Vesting % (per year)</label>
                        <input type="number" id="refresherVesting" min="0" max="100" step="1" value="25">
                        <p style="font-size: 0.75rem; color: #57534e; margin-top: 5px;">% that vests in year granted
                            (typical: 25% for 4-yr vest)</p>
                    </div>
                </div>
            </div>

            <!-- Tax Withholding -->
            <div class="input-section">
                <div class="section-header" onclick="toggleSection('taxWithholdingSection')">
                    <h2>Tax Withholding</h2>
                    <span class="collapse-icon" id="taxWithholdingIcon">â–¼</span>
                </div>
                <div class="collapsible-content" id="taxWithholdingSection">
                    <p style="font-size: 0.85rem; color: #57534e; margin-bottom: 15px;">Optional: Calculate after-tax
                        compensation using progressive federal tax brackets</p>

                    <div class="input-group">
                        <label for="enableTax">
                            <input type="checkbox" id="enableTax" style="width: auto; margin-right: 8px;">
                            Apply tax withholding
                        </label>
                    </div>

                    <div class="input-group">
                        <label for="filingStatus">Filing Status</label>
                        <select id="filingStatus"
                            style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 0.95rem;">
                            <option value="single">Single</option>
                            <option value="married">Married Filing Jointly</option>
                            <option value="head">Head of Household</option>
                        </select>
                        <p style="font-size: 0.75rem; color: #57534e; margin-top: 5px;">Automatically applies 2026
                            standard deduction and progressive brackets</p>
                    </div>

                    <div class="input-group">
                        <label for="stateTaxRate">State Tax Rate (%)</label>
                        <input type="number" id="stateTaxRate" min="0" max="20" step="0.5" value="0">
                        <p style="font-size: 0.75rem; color: #57534e; margin-top: 5px;">CA: ~9-13%, NY: ~4-11%, TX/FL:
                            0%</p>
                    </div>

                    <div class="input-group">
                        <label for="ficaTaxRate">FICA Tax (%)</label>
                        <input type="number" id="ficaTaxRate" min="0" max="20" step="0.01" value="7.65">
                        <p style="font-size: 0.75rem; color: #57534e; margin-top: 5px;">Social Security (6.2%) +
                            Medicare (1.45%) = 7.65%</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="summary-grid">
            <div class="summary-card">
                <div class="summary-label">Year 1 Total</div>
                <div class="summary-value" id="year1Total">$0</div>
                <div class="summary-label" style="font-size: 0.75rem; margin-top: 5px;" id="year1TotalAfterTax"></div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Year 4 Total</div>
                <div class="summary-value" id="year4Total">$0</div>
                <div class="summary-label" style="font-size: 0.75rem; margin-top: 5px;" id="year4TotalAfterTax"></div>
            </div>
            <div class="summary-card">
                <div class="summary-label">4-Year Total</div>
                <div class="summary-value" id="fourYearTotal">$0</div>
                <div class="summary-label" style="font-size: 0.75rem; margin-top: 5px;" id="fourYearTotalAfterTax">
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Average Annual</div>
                <div class="summary-value" id="avgAnnual">$0</div>
                <div class="summary-label" style="font-size: 0.75rem; margin-top: 5px;" id="avgAnnualAfterTax"></div>
            </div>
        </div>

        <!-- Stacked Bar Chart -->
        <div class="chart-container">
            <div class="section-header" onclick="toggleSection('stackedChartSection')">
                <h2>Compensation Breakdown by Year</h2>
                <span class="collapse-icon" id="stackedChartIcon">â–¼</span>
            </div>
            <div class="collapsible-content" id="stackedChartSection">
                <canvas id="stackedChart"></canvas>
            </div>
        </div>

        <!-- Line Chart -->
        <div class="chart-container">
            <div class="section-header" onclick="toggleSection('lineChartSection')">
                <h2>Total Compensation Trend</h2>
                <span class="collapse-icon" id="lineChartIcon">â–¼</span>
            </div>
            <div class="collapsible-content" id="lineChartSection">
                <canvas id="lineChart"></canvas>
            </div>
        </div>

        <!-- Detailed Table -->
        <div class="chart-container">
            <div class="section-header" onclick="toggleSection('detailedTableSection')">
                <h2>Detailed Breakdown</h2>
                <span class="collapse-icon" id="detailedTableIcon">â–¼</span>
            </div>
            <div class="collapsible-content" id="detailedTableSection">
                <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                    <table>
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th class="text-right">Base Salary</th>
                                <th class="text-right">Bonus</th>
                                <th class="text-right">Sign-On</th>
                                <th class="text-right">Initial RSUs</th>
                                <th class="text-right">Refresher RSUs</th>
                                <th class="text-right">Stock Price</th>
                                <th class="text-right">Stock Value</th>
                                <th class="text-right"><strong>Total Comp</strong></th>
                                <th class="text-right" id="afterTaxHeader" style="display: none;"><strong>After
                                        Tax</strong></th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Levels.fyi Comparison -->
        <div class="chart-container">
            <div class="section-header" onclick="toggleSection('levelsFyiSection')">
                <h2>ðŸ“Š Compare with Market Data</h2>
                <span class="collapse-icon" id="levelsFyiIcon">â–¼</span>
            </div>
            <div class="collapsible-content" id="levelsFyiSection">
                <p style="font-size: 0.9rem; color: #57534e; margin-bottom: 15px;">
                    Use the interactive chart below to compare your compensation with market data from levels.fyi
                </p>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label for="levelsCompany"
                            style="display: block; font-weight: 500; color: #080807; margin-bottom: 8px; font-size: 0.9rem;">Company</label>
                        <select id="levelsCompany"
                            style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 0.9rem;">
                            <option value="Meta">Meta</option>
                            <option value="Google">Google</option>
                            <option value="Microsoft">Microsoft</option>
                            <option value="Amazon">Amazon</option>
                            <option value="Apple">Apple</option>
                            <option value="Netflix">Netflix</option>
                            <option value="Uber">Uber</option>
                            <option value="Lyft">Lyft</option>
                            <option value="Airbnb">Airbnb</option>
                            <option value="Dropbox">Dropbox</option>
                            <option value="Yahoo">Yahoo</option>
                            <option value="Pinterest">Pinterest</option>
                            <option value="PayPal">PayPal</option>
                            <option value="Intel">Intel</option>
                            <option value="IBM">IBM</option>
                            <option value="Salesforce">Salesforce</option>
                            <option value="Cisco">Cisco</option>
                            <option value="Workday">Workday</option>
                            <option value="LinkedIn">LinkedIn</option>
                            <option value="eBay">eBay</option>
                            <option value="Oracle">Oracle</option>
                            <option value="Intuit">Intuit</option>
                            <option value="Qualcomm">Qualcomm</option>
                            <option value="VMware">VMware</option>
                            <option value="Square">Square</option>
                            <option value="DoorDash">DoorDash</option>
                            <option value="Snap">Snap</option>
                            <option value="Comcast">Comcast</option>
                            <option value="Stripe">Stripe</option>
                            <option value="Quora">Quora</option>
                            <option value="Yelp">Yelp</option>
                            <option value="Adobe">Adobe</option>
                            <option value="Nextdoor">Nextdoor</option>
                            <option value="Spotify">Spotify</option>
                            <option value="Twitter">Twitter</option>
                            <option value="Zillow">Zillow</option>
                            <option value="Tesla">Tesla</option>
                            <option value="Groupon">Groupon</option>
                            <option value="SAP">SAP</option>
                            <option value="Indeed">Indeed</option>
                            <option value="Symantec">Symantec</option>
                            <option value="NetApp">NetApp</option>
                            <option value="Waymo">Waymo</option>
                            <option value="Nvidia">Nvidia</option>
                            <option value="AMD">AMD</option>
                            <option value="Snowflake">Snowflake</option>
                            <option value="Databricks">Databricks</option>
                            <option value="Atlassian">Atlassian</option>
                            <option value="Twilio">Twilio</option>
                            <option value="GitHub">GitHub</option>
                            <option value="GitLab">GitLab</option>
                            <option value="Asana">Asana</option>
                            <option value="Notion">Notion</option>
                            <option value="Figma">Figma</option>
                            <option value="Slack">Slack</option>
                            <option value="Zoom">Zoom</option>
                            <option value="Coinbase">Coinbase</option>
                            <option value="Robinhood">Robinhood</option>
                            <option value="Affirm">Affirm</option>
                            <option value="Shopify">Shopify</option>
                            <option value="Roblox">Roblox</option>
                            <option value="Unity">Unity</option>
                            <option value="Epic Games">Epic Games</option>
                            <option value="Reddit">Reddit</option>
                            <option value="Discord">Discord</option>
                            <option value="Instacart">Instacart</option>
                            <option value="Grubhub">Grubhub</option>
                            <option value="Expedia">Expedia</option>
                            <option value="Booking.com">Booking.com</option>
                            <option value="Box">Box</option>
                            <option value="Cloudflare">Cloudflare</option>
                            <option value="Datadog">Datadog</option>
                            <option value="Splunk">Splunk</option>
                            <option value="MongoDB">MongoDB</option>
                            <option value="Elastic">Elastic</option>
                            <option value="Palantir">Palantir</option>
                            <option value="Cruise">Cruise</option>
                            <option value="Rivian">Rivian</option>
                            <option value="Bloomberg">Bloomberg</option>
                            <option value="Citadel">Citadel</option>
                            <option value="Two Sigma">Two Sigma</option>
                            <option value="Jane Street">Jane Street</option>
                            <option value="Goldman Sachs">Goldman Sachs</option>
                            <option value="JPMorgan">JPMorgan</option>
                            <option value="Morgan Stanley">Morgan Stanley</option>
                            <option value="Palo Alto Networks">Palo Alto Networks</option>
                            <option value="Crusoe">Crusoe</option>
                            <option value="San Jose Sharks">San Jose Sharks</option>
                            <option value="Ramp">Ramp</option>
                        </select>
                    </div>

                    <div>
                        <label for="levelsTrack"
                            style="display: block; font-weight: 500; color: #080807; margin-bottom: 8px; font-size: 0.9rem;">Job
                            Track</label>
                        <select id="levelsTrack"
                            style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 0.9rem;">
                            <option value="Software Engineer">Software Engineer</option>
                            <option value="Product Manager">Product Manager</option>
                            <option value="Data Scientist">Data Scientist</option>
                            <option value="Machine Learning Engineer">Machine Learning Engineer</option>
                            <option value="Software Engineering Manager">Software Engineering Manager</option>
                            <option value="Product Designer">Product Designer</option>
                            <option value="Data Engineer">Data Engineer</option>
                            <option value="Technical Program Manager">Technical Program Manager</option>
                            <option value="Solutions Architect">Solutions Architect</option>
                            <option value="DevOps Engineer">DevOps Engineer</option>
                            <option value="Security Engineer">Security Engineer</option>
                            <option value="QA Engineer">QA Engineer</option>
                            <option value="Mechanical Engineer">Mechanical Engineer</option>
                            <option value="Hardware Engineer">Hardware Engineer</option>
                            <option value="Recruiter">Recruiter</option>
                            <option value="Customer Success">Customer Success</option>
                            <option value="Sales">Sales</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Finance">Finance</option>
                            <option value="Legal">Legal</option>
                            <option value="General Counsel">General Counsel</option>
                            <option value="Operations">Operations</option>
                            <option value="Business Analyst">Business Analyst</option>
                            <option value="Account Manager">Account Manager</option>
                            <option value="Product Marketing Manager">Product Marketing Manager</option>
                        </select>
                    </div>
                </div>

                <iframe id="levelsIframe"
                    src="https://www.levels.fyi/charts_embed.html?company=Meta&track=Software%20Engineer&hide_selector=true"
                    height="500" style="width: 100%; border: 1px solid #e5e7eb; border-radius: 8px;" frameborder="0"
                    scrolling="auto">
                </iframe>
            </div>
        </div>

        <div class="note">
            <strong>Note:</strong> This calculator shows your initial grant vesting schedule (40/30/20/10) plus any
            refresher grants you add.
            Refresher RSUs typically vest over 4 years (25% per year by default, adjustable). The calculator assumes
            each refresher grant starts
            vesting in the year it's granted and continues vesting in subsequent years. For example, a Year 2 refresher
            will vest in Years 2, 3,
            and 4. Ask your recruiter for the specific refresher amounts and vesting schedules!
            <br><br>
            <strong>ðŸ’¾ Auto-Save:</strong> Your inputs are automatically saved in your browser and will persist when you
            refresh the page.
            <button onclick="resetCalculator()"
                style="margin-left: 10px; padding: 5px 15px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">
                Reset to Defaults
            </button>
        </div>
    </div>

    <script>
        function resetCalculator() {
            if (confirm('Are you sure you want to reset all values to defaults? This cannot be undone.')) {
                localStorage.removeItem('databricksCompCalc');
                location.reload();
            }
        }

        function getVestingSchedule() {
            const scheduleType = document.getElementById('vestingSchedule').value;
            if (scheduleType === 'front') {
                return [0.40, 0.30, 0.20, 0.10];
            } else {
                return [0.25, 0.25, 0.25, 0.25];
            }
        }

        // 2026 Federal tax brackets and standard deductions
        const taxData2026 = {
            single: {
                standardDeduction: 15000,
                brackets: [
                    { rate: 0.10, limit: 11925 },
                    { rate: 0.12, limit: 48475 },
                    { rate: 0.22, limit: 103350 },
                    { rate: 0.24, limit: 197300 },
                    { rate: 0.32, limit: 250525 },
                    { rate: 0.35, limit: 626350 },
                    { rate: 0.37, limit: Infinity }
                ]
            },
            married: {
                standardDeduction: 30000,
                brackets: [
                    { rate: 0.10, limit: 23850 },
                    { rate: 0.12, limit: 96950 },
                    { rate: 0.22, limit: 206700 },
                    { rate: 0.24, limit: 394600 },
                    { rate: 0.32, limit: 501050 },
                    { rate: 0.35, limit: 751600 },
                    { rate: 0.37, limit: Infinity }
                ]
            },
            head: {
                standardDeduction: 22500,
                brackets: [
                    { rate: 0.10, limit: 17000 },
                    { rate: 0.12, limit: 64850 },
                    { rate: 0.22, limit: 103350 },
                    { rate: 0.24, limit: 197300 },
                    { rate: 0.32, limit: 250500 },
                    { rate: 0.35, limit: 626350 },
                    { rate: 0.37, limit: Infinity }
                ]
            }
        };

        // Calculate progressive federal tax
        function calculateProgressiveFederalTax(grossIncome, filingStatus) {
            const statusData = taxData2026[filingStatus];
            const standardDeduction = statusData.standardDeduction;
            const brackets = statusData.brackets;

            // Apply standard deduction
            const taxableIncome = Math.max(0, grossIncome - standardDeduction);

            if (taxableIncome <= 0) {
                return 0;
            }

            let totalTax = 0;
            let previousLimit = 0;

            for (let i = 0; i < brackets.length; i++) {
                const bracket = brackets[i];
                const bracketLimit = bracket.limit;

                if (taxableIncome > previousLimit) {
                    const taxableInBracket = Math.min(taxableIncome, bracketLimit) - previousLimit;
                    totalTax += taxableInBracket * bracket.rate;

                    if (taxableIncome <= bracketLimit) {
                        break;
                    }
                }

                previousLimit = bracketLimit;
            }

            return totalTax;
        }

        let stackedChart, lineChart;

        // Save inputs to localStorage
        function saveInputs() {
            const inputs = [
                'baseSalary', 'bonusPercent', 'signOnBonus',
                'stockYear1', 'stockYear2', 'stockYear3', 'stockYear4', 'stockGrowth',
                'initialGrant', 'vestingSchedule', 'refresherYear2', 'refresherYear3', 'refresherYear4', 'refresherVesting',
                'filingStatus', 'stateTaxRate', 'ficaTaxRate'
            ];

            const values = {};
            inputs.forEach(id => {
                const element = document.getElementById(id);
                values[id] = element.value;
            });

            // Handle checkbox separately
            values['enableTax'] = document.getElementById('enableTax').checked;

            // Save Select2 dropdowns (company and job track)
            values['levelsCompany'] = $('#levelsCompany').val();
            values['levelsTrack'] = $('#levelsTrack').val();

            localStorage.setItem('databricksCompCalc', JSON.stringify(values));
        }

        // Load inputs from localStorage
        function loadInputs() {
            const saved = localStorage.getItem('databricksCompCalc');
            if (saved) {
                try {
                    const values = JSON.parse(saved);
                    Object.keys(values).forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            if (id === 'enableTax') {
                                element.checked = values[id];
                            } else {
                                element.value = values[id];
                            }
                        }
                    });

                    // Load Select2 values if they exist
                    if (values['levelsCompany']) {
                        $('#levelsCompany').val(values['levelsCompany']);
                    }
                    if (values['levelsTrack']) {
                        $('#levelsTrack').val(values['levelsTrack']);
                    }
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        function formatCurrency(value) {
            return '$' + Math.round(value).toLocaleString();
        }

        function calculateComp() {
            const baseSalary = parseInt(document.getElementById('baseSalary').value) || 0;
            const bonusPercent = parseFloat(document.getElementById('bonusPercent').value) || 0;
            const signOnBonus = parseInt(document.getElementById('signOnBonus').value) || 0;
            const annualRaise = 0.03; // Fixed 3% annual raise

            const initialGrant = parseFloat(document.getElementById('initialGrant').value) || 0;
            const vestingSchedule = getVestingSchedule();

            const stockPrices = [
                parseFloat(document.getElementById('stockYear1').value),
                parseFloat(document.getElementById('stockYear2').value),
                parseFloat(document.getElementById('stockYear3').value),
                parseFloat(document.getElementById('stockYear4').value)
            ];

            const refresherGrants = [
                0, // Year 1 - no refresher
                parseFloat(document.getElementById('refresherYear2').value),
                parseFloat(document.getElementById('refresherYear3').value),
                parseFloat(document.getElementById('refresherYear4').value)
            ];

            const refresherVestingPercent = parseFloat(document.getElementById('refresherVesting').value) / 100;

            // Tax calculation
            const enableTax = document.getElementById('enableTax').checked;
            const filingStatus = document.getElementById('filingStatus').value;
            const stateTaxRate = parseFloat(document.getElementById('stateTaxRate').value) / 100;
            const ficaTaxRate = parseFloat(document.getElementById('ficaTaxRate').value) / 100;

            const years = [];

            for (let i = 0; i < 4; i++) {
                const currentBaseSalary = baseSalary * Math.pow(1 + annualRaise, i);
                const bonus = currentBaseSalary * (bonusPercent / 100);
                // Add sign-on bonus only in Year 1
                const signOn = (i === 0) ? signOnBonus : 0;

                // Initial grant vesting
                const initialSharesVested = initialGrant * vestingSchedule[i];

                // Refresher vesting - each refresher vests over time
                let refresherSharesVested = 0;

                // Year 2: only year 2 refresher vests (first year)
                // Year 3: year 2 refresher (2nd year) + year 3 refresher (1st year)
                // Year 4: year 2 refresher (3rd year) + year 3 refresher (2nd year) + year 4 refresher (1st year)
                if (i >= 1) { // Year 2+
                    refresherSharesVested += refresherGrants[i] * refresherVestingPercent; // Current year's refresher
                }
                if (i >= 2) { // Year 3+
                    refresherSharesVested += refresherGrants[i - 1] * refresherVestingPercent; // Last year's refresher
                }
                if (i >= 3) { // Year 4
                    refresherSharesVested += refresherGrants[i - 2] * refresherVestingPercent; // 2 years ago refresher
                }

                const totalSharesVested = initialSharesVested + refresherSharesVested;
                const stockValue = totalSharesVested * stockPrices[i];
                const totalComp = currentBaseSalary + bonus + signOn + stockValue;

                // Calculate progressive taxes
                let afterTaxComp = totalComp;
                if (enableTax) {
                    const federalTax = calculateProgressiveFederalTax(totalComp, filingStatus);
                    const stateTax = totalComp * stateTaxRate;
                    const ficaTax = totalComp * ficaTaxRate;
                    const totalTax = federalTax + stateTax + ficaTax;
                    afterTaxComp = Math.round(totalComp - totalTax);
                }

                years.push({
                    year: i + 1,
                    baseSalary: Math.round(currentBaseSalary),
                    bonus: Math.round(bonus),
                    signOnBonus: Math.round(signOn),
                    initialSharesVested: Math.round(initialSharesVested),
                    refresherSharesVested: Math.round(refresherSharesVested),
                    stockPrice: stockPrices[i],
                    stockValue: Math.round(stockValue),
                    totalComp: Math.round(totalComp),
                    afterTaxComp: afterTaxComp
                });
            }

            return years;
        }

        function updateDisplay() {
            const data = calculateComp();
            const enableTax = document.getElementById('enableTax').checked;

            // Update summary cards
            document.getElementById('year1Total').textContent = formatCurrency(data[0].totalComp);
            document.getElementById('year4Total').textContent = formatCurrency(data[3].totalComp);

            const fourYearTotal = data.reduce((sum, year) => sum + year.totalComp, 0);
            document.getElementById('fourYearTotal').textContent = formatCurrency(fourYearTotal);
            document.getElementById('avgAnnual').textContent = formatCurrency(fourYearTotal / 4);

            // Show/hide after-tax values in summary cards
            if (enableTax) {
                document.getElementById('year1TotalAfterTax').textContent = 'After tax: ' + formatCurrency(data[0].afterTaxComp);
                document.getElementById('year4TotalAfterTax').textContent = 'After tax: ' + formatCurrency(data[3].afterTaxComp);
                const fourYearAfterTax = data.reduce((sum, year) => sum + year.afterTaxComp, 0);
                document.getElementById('fourYearTotalAfterTax').textContent = 'After tax: ' + formatCurrency(fourYearAfterTax);
                document.getElementById('avgAnnualAfterTax').textContent = 'After tax: ' + formatCurrency(fourYearAfterTax / 4);
            } else {
                document.getElementById('year1TotalAfterTax').textContent = '';
                document.getElementById('year4TotalAfterTax').textContent = '';
                document.getElementById('fourYearTotalAfterTax').textContent = '';
                document.getElementById('avgAnnualAfterTax').textContent = '';
            }

            // Show/hide after-tax column in table
            const afterTaxHeader = document.getElementById('afterTaxHeader');
            afterTaxHeader.style.display = enableTax ? '' : 'none';

            // Update table
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = data.map(row => `
                <tr>
                    <td>Year ${row.year}</td>
                    <td class="text-right">${formatCurrency(row.baseSalary)}</td>
                    <td class="text-right">${formatCurrency(row.bonus)}</td>
                    <td class="text-right">${row.signOnBonus > 0 ? formatCurrency(row.signOnBonus) : '-'}</td>
                    <td class="text-right">${row.initialSharesVested}</td>
                    <td class="text-right">${row.refresherSharesVested}</td>
                    <td class="text-right">$${row.stockPrice}</td>
                    <td class="text-right">${formatCurrency(row.stockValue)}</td>
                    <td class="text-right"><strong>${formatCurrency(row.totalComp)}</strong></td>
                    ${enableTax ? `<td class="text-right"><strong>${formatCurrency(row.afterTaxComp)}</strong></td>` : ''}
                </tr>
            `).join('');

            // Update charts
            updateCharts(data);
        }

        function updateCharts(data) {
            const labels = data.map(d => `Year ${d.year}`);
            const enableTax = document.getElementById('enableTax').checked;

            // Stacked Bar Chart
            if (stackedChart) stackedChart.destroy();
            const stackedCtx = document.getElementById('stackedChart').getContext('2d');

            const datasets = [
                {
                    label: 'Base Salary',
                    data: data.map(d => d.baseSalary),
                    backgroundColor: '#3b82f6',
                    stack: 'pre-tax'
                },
                {
                    label: 'Bonus',
                    data: data.map(d => d.bonus),
                    backgroundColor: '#10b981',
                    stack: 'pre-tax'
                },
                {
                    label: 'Stock Value',
                    data: data.map(d => d.stockValue),
                    backgroundColor: '#8b5cf6',
                    stack: 'pre-tax'
                }
            ];

            // Add after-tax bar as separate grouped bar if tax is enabled
            if (enableTax) {
                datasets.push({
                    label: 'After Tax',
                    data: data.map(d => d.afterTaxComp),
                    backgroundColor: '#ef4444',
                    stack: 'after-tax'
                });
            }

            stackedChart = new Chart(stackedCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: { stacked: false }, // Group bars instead of stacking
                        y: {
                            stacked: true, // Stack within each group
                            ticks: {
                                callback: function (value) {
                                    return '$' + (value / 1000).toFixed(0) + 'k';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Line Chart
            if (lineChart) lineChart.destroy();
            const lineCtx = document.getElementById('lineChart').getContext('2d');

            const lineDatasets = [{
                label: 'Total Compensation',
                data: data.map(d => d.totalComp),
                borderColor: '#8b5cf6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: true
            }];

            // Add after-tax line if tax is enabled
            if (enableTax) {
                lineDatasets.push({
                    label: 'After Tax Compensation',
                    data: data.map(d => d.afterTaxComp),
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    borderWidth: 3,
                    borderDash: [10, 5],
                    tension: 0.4,
                    fill: true
                });
            }

            lineChart = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: lineDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            ticks: {
                                callback: function (value) {
                                    return '$' + (value / 1000).toFixed(0) + 'k';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update display values as inputs change
        function setupInputListeners() {
            const inputs = [
                'baseSalary', 'bonusPercent', 'signOnBonus',
                'initialGrant', 'vestingSchedule', 'refresherYear2', 'refresherYear3', 'refresherYear4', 'refresherVesting',
                'enableTax', 'filingStatus', 'stateTaxRate', 'ficaTaxRate'
            ];

            inputs.forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('input', function () {
                    saveInputs();
                    updateDisplay();
                });
            });

            // Special handling for stock inputs
            const stockInputs = ['stockYear1', 'stockYear2', 'stockYear3', 'stockYear4'];
            stockInputs.forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('input', function () {
                    saveInputs();
                    updateDisplay();
                });
            });

            // Special handling for stock growth - auto-calculate Years 2-4
            const stockGrowthInput = document.getElementById('stockGrowth');
            const stockYear1Input = document.getElementById('stockYear1');

            function applyStockGrowth() {
                const year1Price = parseFloat(stockYear1Input.value) || 0;
                const growthPercent = parseFloat(stockGrowthInput.value) || 0;
                const growthMultiplier = 1 + (growthPercent / 100);

                // Only auto-update if growth is not zero
                if (growthPercent !== 0) {
                    document.getElementById('stockYear2').value = Math.round(year1Price * growthMultiplier);
                    document.getElementById('stockYear3').value = Math.round(year1Price * Math.pow(growthMultiplier, 2));
                    document.getElementById('stockYear4').value = Math.round(year1Price * Math.pow(growthMultiplier, 3));
                    saveInputs();
                    updateDisplay();
                }
            }

            stockGrowthInput.addEventListener('input', function () {
                applyStockGrowth();
                saveInputs();
            });
        }

        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId.replace('Section', 'Icon'));

            section.classList.toggle('collapsed');
            icon.classList.toggle('collapsed');
        }

        // Update levels.fyi iframe based on dropdown selections
        function updateLevelsIframe() {
            const company = document.getElementById('levelsCompany').value;
            const track = document.getElementById('levelsTrack').value;
            const iframe = document.getElementById('levelsIframe');

            // URL encode the track parameter
            const encodedTrack = encodeURIComponent(track);

            iframe.src = `https://www.levels.fyi/charts_embed.html?company=${company}&track=${encodedTrack}&hide_selector=true`;
        }

        // Initialize
        loadInputs();
        setupInputListeners();

        // Initialize Select2 for searchable dropdowns
        $(document).ready(function () {
            $('#levelsCompany').select2({
                placeholder: 'Search for a company...',
                allowClear: false,
                width: '100%'
            });

            $('#levelsTrack').select2({
                placeholder: 'Search for a job track...',
                allowClear: false,
                width: '100%'
            });

            // Trigger Select2 to update with loaded values
            $('#levelsCompany').trigger('change.select2');
            $('#levelsTrack').trigger('change.select2');

            // Update iframe when Select2 dropdowns change
            $('#levelsCompany').on('change', function () {
                updateLevelsIframe();
                saveInputs(); // Save to localStorage
            });

            $('#levelsTrack').on('change', function () {
                updateLevelsIframe();
                saveInputs(); // Save to localStorage
            });
        });

        updateDisplay();
    </script>
</body>

</html>